# Docker Compose configuration for Soketi WebSocket server
# Run with: docker-compose -f docker-compose.soketi.yml up -d

version: '3.8'

services:
  soketi:
    image: quay.io/soketi/soketi:1.6-16-debian
    container_name: soketi
    restart: unless-stopped
    ports:
      - "${SOKETI_PORT:-6001}:6001"
      - "${SOKETI_METRICS_PORT:-9601}:9601"
    environment:
      SOKETI_DEBUG: "${SOKETI_DEBUG:-1}"
      SOKETI_DEFAULT_APP_ID: "${PUSHER_APP_ID:-app-id}"
      SOKETI_DEFAULT_APP_KEY: "${PUSHER_APP_KEY:-app-key}"
      SOKETI_DEFAULT_APP_SECRET: "${PUSHER_APP_SECRET:-app-secret}"
      SOKETI_DEFAULT_APP_MAX_CONNS: "${SOKETI_MAX_CONNECTIONS:-100}"
      SOKETI_DEFAULT_APP_ENABLE_CLIENT_MESSAGES: "${SOKETI_ENABLE_CLIENT_MESSAGES:-true}"
      SOKETI_DEFAULT_APP_ENABLED: "true"
      SOKETI_DEFAULT_APP_MAX_BACKEND_EVENTS_PER_SEC: "${SOKETI_MAX_EVENTS_PER_SEC:-200}"
      SOKETI_DEFAULT_APP_MAX_CLIENT_EVENTS_PER_SEC: "${SOKETI_MAX_CLIENT_EVENTS_PER_SEC:-200}"
      SOKETI_DEFAULT_APP_MAX_READ_REQ_PER_SEC: "${SOKETI_MAX_READ_REQ_PER_SEC:-200}"
      SOKETI_METRICS_ENABLED: "true"
      SOKETI_METRICS_SERVER_PORT: "9601"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:6001"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - app-network

  # Optional: Redis for horizontal scaling (uncomment if needed)
  # redis:
  #   image: redis:7-alpine
  #   container_name: soketi-redis
  #   restart: unless-stopped
  #   ports:
  #     - "6380:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - app-network

networks:
  app-network:
    driver: bridge

# volumes:
#   redis-data:
